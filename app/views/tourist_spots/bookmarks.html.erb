
<h1 class="text-center my-4">ブックマーク一覧</h1>

<% if @bookmark_tourist_spots.any? %>
  <div class="container">
    <div class="row row-cols-1 row-cols-md-2 g-4">
      <% @bookmark_tourist_spots.each do |spot| %>
        <div class="col">
          <div class="card h-100">
            <div class="card-body">
              <h5 class="card-title d-flex justify-content-between align-items-center">
                <%= spot["name"] %>
                <button class="btn btn-outline-primary bookmark-button" 
                        data-spot-id="<%= spot["id"] %>" 
                        data-bookmarked="true"
                        data-bookmark-id="<%= spot[:bookmark_id] %>">
                  <i class="bi bi-star-fill"></i>
                </button>
              </h5>
              <p class="card-text"><strong>住所:</strong> <%= spot["address"] %></p>
              <p class="card-text"><strong>カテゴリ:</strong> <%= spot["category"] %></p>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
<% else %>
  <p class="text-center mt-4">ブックマークされた観光地はありません。</p>
<% end %>

<script>
  document.querySelectorAll(".bookmark-button").forEach(button => {
    button.addEventListener("click", function() {
      const spotId = this.getAttribute("data-spot-id");
      const bookmarked = this.getAttribute("data-bookmarked") === "true";
      const bookmarkId = this.getAttribute("data-bookmark-id");
      const method = bookmarked ? "DELETE" : "POST";
      const url = bookmarked ? `/bookmarks/${bookmarkId}` : "/bookmarks";

      fetch(url, {
        method: method,
        headers: {
          "Content-Type": "application/json",
          "X-CSRF-Token": document.querySelector('meta[name="csrf-token"]').getAttribute("content")
        },
        body: method === "POST" ? JSON.stringify({ tourist_spot_id: spotId }) : null
      }).then(response => response.json())
        .then(data => {
          if (data.error) {
            alert('操作に失敗しました: ' + data.error);
          } else {
            this.setAttribute("data-bookmarked", !bookmarked);
            this.querySelector("i").classList.toggle("bi-star-fill");
            this.querySelector("i").classList.toggle("bi-star");
          }
        }).catch(error => {
          console.error("Error:", error);
          alert("操作に失敗しました。");
        });
    });
  });
</script>
